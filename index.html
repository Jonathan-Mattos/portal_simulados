<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal de Simulados - Firjan Senai Caxias</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-blue: #17319b;
            --dark-blue: #0d1b5a;
            --accent-blue: #15b3d9;
            --white: #ffffff;
            --correct-green: #27ae60;
            --wrong-red: #d63031;
            --gray: #f4f7f6;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--primary-blue);
            margin: 0; display: flex; height: 100vh; overflow: hidden;
            user-select: none; /* Impede seleção de texto para dificultar cópia */
        }

        /* --- MENU LATERAL (SIDEBAR) --- */
        .sidebar {
            width: 300px; background: var(--dark-blue); color: white;
            display: flex; flex-direction: column; border-right: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar-header { padding: 30px 20px; text-align: center; background: rgba(0,0,0,0.2); }
        .sidebar-header h2 { font-size: 1.2rem; margin: 0; letter-spacing: 1px; }

        .menu-container { flex-grow: 1; overflow-y: auto; padding: 15px; }

        .category-item { margin-bottom: 10px; }
        .category-btn {
            width: 100%; padding: 12px 15px; background: none; border: none;
            color: white; text-align: left; font-weight: bold; cursor: pointer;
            display: flex; justify-content: space-between; align-items: center;
            border-radius: 6px; transition: 0.3s;
        }
        .category-btn:hover { background: rgba(255,255,255,0.1); }

        .subcategory-list { display: none; padding-left: 15px; margin-top: 5px; }
        .subcategory-list.active { display: block; }

        .simulado-link {
            display: block; color: #adb5bd; text-decoration: none; padding: 10px;
            font-size: 0.9rem; border-radius: 4px; transition: 0.2s;
        }
        .simulado-link:hover { color: white; background: var(--primary-blue); }

        /* --- ÁREA DO CONTEÚDO --- */
        .main-content {
            flex-grow: 1; display: flex; flex-direction: column;
            align-items: center; justify-content: center; padding: 20px; overflow-y: auto;
        }

        .quiz-container {
            background: var(--white); width: 100%; max-width: 900px;
            min-height: 500px; border-radius: 12px; padding: 40px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.4); position: relative;
        }

        /* Elementos Internos */
        .timer-badge {
            position: absolute; top: 20px; right: 30px;
            background: #eee; padding: 8px 15px; border-radius: 20px;
            font-weight: bold; color: var(--wrong-red);
        }

        .question-text { font-size: 1.3rem; font-weight: 600; color: #333; margin-bottom: 25px; line-height: 1.4; }

        .option-card {
            padding: 15px; border: 2px solid #e0e0e0; border-radius: 8px;
            margin-bottom: 12px; cursor: pointer; transition: 0.2s;
        }
        .option-card:hover { border-color: var(--primary-blue); background: #f0f4ff; }
        .option-card.selected { border-color: var(--primary-blue); background: #e0e7ff; font-weight: bold; }

        .btn-action {
            padding: 12px 30px; border: none; border-radius: 6px;
            font-weight: bold; cursor: pointer; background: var(--correct-green); color: white;
        }

        #welcome-msg { text-align: center; color: white; }

        /* Review */
        .review-box { margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; }
    </style>
</head>
<body oncontextmenu="return false;"> <div class="sidebar">
        <div class="sidebar-header">
            <h2>PORTAL SENAI</h2>
            <p style="font-size: 0.8rem; opacity: 0.7;">Simulados de Avaliação</p>
        </div>
        
 <div class="menu-container">

    <div class="category-item">
        <button class="category-btn" onclick="toggleMenu('eletro-menu')">ELETROELETRÔNICA APLICADA <span>▼</span></button>
        <div id="eletro-menu" class="subcategory-list">
            <a href="javascript:void(0);" class="simulado-link" onclick="setupSimulado('LINK_SIMULADO_1', 'Eletroeletrônica - Simulado 1'); return false;">Simulado 1</a>
            <a href="javascript:void(0);" class="simulado-link" onclick="setupSimulado('LINK_SIMULADO_2', 'Eletroeletrônica - Simulado 2'); return false;">Simulado 2</a>
        </div>
    </div>

    <div class="category-item">
        <button class="category-btn" onclick="toggleMenu('logica-menu')">LÓGICA DE PROGRAMAÇÃO <span>▼</span></button>
        <div id="logica-menu" class="subcategory-list">
            <a href="javascript:void(0);" class="simulado-link" onclick="setupSimulado('LINK_SIMULADO_1', 'Lógica - Simulado 1'); return false;">Simulado 1</a>
            <a href="javascript:void(0);" class="simulado-link" onclick="setupSimulado('LINK_SIMULADO_2', 'Lógica - Simulado 2'); return false;">Simulado 2</a>
        </div>
    </div>

    <div class="category-item">
        <button class="category-btn" onclick="toggleMenu('modelagem-menu')">MODELAGEM DE SISTEMAS <span>▼</span></button>
        <div id="modelagem-menu" class="subcategory-list">
            <a href="javascript:void(0);" class="simulado-link" onclick="setupSimulado('LINK_SIMULADO_1', 'Modelagem - Simulado 1'); return false;">Simulado 1</a>
            <a href="javascript:void(0);" class="simulado-link" onclick="setupSimulado('LINK_SIMULADO_2', 'Modelagem - Simulado 2'); return false;">Simulado 2</a>
        </div>
    </div>

    <div class="category-item">
        <button class="category-btn" onclick="toggleMenu('bd-menu')">BANCO DE DADOS <span>▼</span></button>
        <div id="bd-menu" class="subcategory-list">
            <a href="javascript:void(0);" class="simulado-link" onclick="setupSimulado('https://docs.google.com/spreadsheets/d/e/2PACX-1vT9XNps8c6jUHWhOzqpRnTD-rkdMI9Y-ZE11sk-OQrGmUtOOhjBFxuAT-z2zduB47CXd7tvn3DcmJyJ/pub?output=csv', 'Banco de Dados - Simulado 1'); return false;">Simulado 1</a>
            <a href="javascript:void(0);" class="simulado-link" onclick="setupSimulado('LINK_SIMULADO_2', 'Banco de Dados - Simulado 2'); return false;">Simulado 2</a>
        </div>
    </div>

    <div class="category-item">
        <button class="category-btn" onclick="toggleMenu('dev-sist-menu')">DESENVOLVIMENTO DE SISTEMAS <span>▼</span></button>
        <div id="dev-sist-menu" class="subcategory-list">
            <a href="javascript:void(0);" class="simulado-link" onclick="setupSimulado('LINK_SIMULADO_1', 'Dev. Sistemas - Simulado 1'); return false;">Simulado 1</a>
            <a href="javascript:void(0);" class="simulado-link" onclick="setupSimulado('LINK_SIMULADO_2', 'Dev. Sistemas - Simulado 2'); return false;">Simulado 2</a>
        </div>
    </div>

    <div class="category-item">
        <button class="category-btn" onclick="toggleMenu('teste-menu')">TESTE DE SISTEMAS <span>▼</span></button>
        <div id="teste-menu" class="subcategory-list">
            <a href="javascript:void(0);" class="simulado-link" onclick="setupSimulado('LINK_SIMULADO_1', 'Teste de Sistemas - Simulado 1'); return false;">Simulado 1</a>
            <a href="javascript:void(0);" class="simulado-link" onclick="setupSimulado('LINK_SIMULADO_2', 'Teste de Sistemas - Simulado 2'); return false;">Simulado 2</a>
        </div>
    </div>

    <div class="category-item">
        <button class="category-btn" onclick="toggleMenu('mobile-menu')">DEV. DE APLICATIVO MOBILE <span>▼</span></button>
        <div id="mobile-menu" class="subcategory-list">
            <a href="javascript:void(0);" class="simulado-link" onclick="setupSimulado('LINK_SIMULADO_1', 'Mobile - Simulado 1'); return false;">Simulado 1</a>
            <a href="javascript:void(0);" class="simulado-link" onclick="setupSimulado('LINK_SIMULADO_2', 'Mobile - Simulado 2'); return false;">Simulado 2</a>
        </div>
    </div>

    <div class="category-item">
        <button class="category-btn" onclick="toggleMenu('iot-menu')">INTERNET DAS COISAS <span>▼</span></button>
        <div id="iot-menu" class="subcategory-list">
            <a href="javascript:void(0);" class="simulado-link" onclick="setupSimulado('LINK_SIMULADO_1', 'IoT - Simulado 1'); return false;">Simulado 1</a>
            <a href="javascript:void(0);" class="simulado-link" onclick="setupSimulado('LINK_SIMULADO_2', 'IoT - Simulado 2'); return false;">Simulado 2</a>
        </div>
    </div>

    <div class="category-item">
        <button class="category-btn" onclick="toggleMenu('manutencao-menu')">IMPLANTAÇÃO E MANUTENÇÃO <span>▼</span></button>
        <div id="manutencao-menu" class="subcategory-list">
            <a href="javascript:void(0);" class="simulado-link" onclick="setupSimulado('LINK_SIMULADO_1', 'Manutenção - Simulado 1'); return false;">Simulado 1</a>
            <a href="javascript:void(0);" class="simulado-link" onclick="setupSimulado('LINK_SIMULADO_2', 'Manutenção - Simulado 2'); return false;">Simulado 2</a>
        </div>
    </div>

</div>
    </div>

    <div class="main-content">
        <div id="welcome-msg">
            <h1>Bem-vindo ao Portal de Simulados SAEP do SENAI Caxias</h1><h1>Desenvolvimento de Sistemas </h1>
            <h2>Selecione uma disciplina no menu lateral para começar.</h2>
        </div>

        <div class="quiz-container" id="quiz-ui" style="display: none;">
            <div class="timer-badge">⏳ <span id="timer">00:00:00</span></div>
            <h2 id="current-title" style="color: var(--primary-blue); margin-top: 0;"></h2>
            
            <div id="loading-status" style="display:none;">Carregando questões...</div>

            <div id="quiz-core">
                <div id="questionNumber" style="color: #888; margin-bottom: 10px;"></div>
                <div class="question-text" id="questionText"></div>
                <div id="optionsGrid"></div>

                <div style="margin-top: 30px; display: flex; justify-content: space-between;">
                    <button class="btn-action" style="background:#666" onclick="prevQ()">Anterior</button>
                    <button class="btn-action" id="next-btn" onclick="nextQ()">Próxima</button>
                    <button class="btn-action" id="finish-btn" style="display:none; background: var(--dark-blue);" onclick="finishQuiz()">Finalizar Teste</button>
                </div>
            </div>

            <div id="result-screen" style="display:none; text-align: center;">
                <h2>Resultado Final</h2>
                <canvas id="scoreChart" style="max-height: 250px; margin: 0 auto;"></canvas>
                <h3 id="score-text"></h3>
                <div id="feedback-msg"></div>
                <div id="review-area" style="text-align: left; margin-top: 30px;"></div>
            </div>
        </div>
    </div>

    <script>
        // --- SEGURANÇA ---
        const ACESSO = "Firjan2024"; 
        
        (function() {
            const entrada = prompt("Palavra-passe de acesso ao sistema:");
            if(entrada !== ACESSO) {
                alert("Acesso negado.");
                document.body.innerHTML = "";
                window.stop();
            }
        })();

        // Bloqueio F12 e Ctrl+U
        document.onkeydown = function(e) {
            if (e.keyCode == 123 || (e.ctrlKey && (e.keyCode == 'U'.charCodeAt(0) || e.keyCode == 'I'.charCodeAt(0)))) {
                return false;
            }
        };

        // --- LÓGICA DO MENU ---
        function toggleMenu(id) {
            document.querySelectorAll('.subcategory-list').forEach(m => {
                if(m.id !== id) m.classList.remove('active');
            });
            document.getElementById(id).classList.toggle('active');
        }

        // --- LÓGICA DO QUIZ ---
        let questions = [];
        let currentIdx = 0;
        let answers = [];
        let timeLeft = 7200;
        let timerInt;

async function setupSimulado(url, titulo) {
    // Evita comportamentos inesperados do navegador
    if (event) event.preventDefault(); 

    // Se o link for um dos marcadores de posição, avisa o usuário
    if(!url || url.includes('SEU_LINK') || url.includes('OUTRO_LINK') || url.includes('LINK_GESTAO')) {
        return alert("Link da planilha não configurado para este simulado.");
    }
            
            clearInterval(timerInt);
            document.getElementById('welcome-msg').style.display = 'none';
            document.getElementById('quiz-ui').style.display = 'block';
            document.getElementById('quiz-core').style.display = 'none';
            document.getElementById('result-screen').style.display = 'none';
            document.getElementById('loading-status').style.display = 'block';
            document.getElementById('loading-status').innerHTML = "Carregando questões...";
            document.getElementById('current-title').innerText = titulo;

            try {
                // Adicionamos um timestamp para evitar cache do navegador
                const response = await fetch(url + "&t=" + new Date().getTime());
                if (!response.ok) throw new Error('Erro na requisição');
                
                const csvData = await response.text();
                
                // Divide por linhas e remove linhas vazias
                const rows = csvData.split(/\r?\n/).filter(r => r.trim() !== "");
                
                questions = rows.slice(1).map(row => {
                    // Separa por vírgula respeitando aspas (essencial para o Google Sheets)
                    const cols = row.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
                    
                    if (cols && cols.length >= 6) {
                        // Função interna para limpar aspas e espaços extras
                        const clean = (t) => t ? t.replace(/^"|"$/g, "").trim() : "";
                        
                        return {
                            q: clean(cols[0]),
                            options: [clean(cols[1]), clean(cols[2]), clean(cols[3]), clean(cols[4])],
                            correct: parseInt(clean(cols[5])),
                            exp: cols[6] ? clean(cols[6]) : "Sem comentário técnico."
                        };
                    }
                    return null;
                }).filter(q => q !== null);

                if (questions.length === 0) throw new Error('Planilha vazia');

                // Inicializa variáveis do Simulado
                answers = new Array(questions.length).fill(null);
                currentIdx = 0;
                timeLeft = 7200;
                
                document.getElementById('loading-status').style.display = 'none';
                document.getElementById('quiz-core').style.display = 'block';
                startTimer();
                renderQ();

            } catch (e) {
                console.error(e);
                document.getElementById('loading-status').innerHTML = 
                    `<b style="color:red">Erro ao conectar!</b><br>Verifique se a planilha está 'Publicada na Web' como CSV.`;
            }
        }
        function startTimer() {
            timerInt = setInterval(() => {
                const h = Math.floor(timeLeft / 3600);
                const m = Math.floor((timeLeft % 3600) / 60);
                const s = timeLeft % 60;
                document.getElementById('timer').innerText = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
                if(timeLeft <= 0) finishQuiz();
                timeLeft--;
            }, 1000);
        }

        function renderQ() {
            const q = questions[currentIdx];
            document.getElementById('questionNumber').innerText = `Questão ${currentIdx + 1} de ${questions.length}`;
            document.getElementById('questionText').innerText = q.q;
            
            const grid = document.getElementById('optionsGrid');
            grid.innerHTML = "";
            q.options.forEach((opt, i) => {
                const div = document.createElement('div');
                div.className = `option-card ${answers[currentIdx] === i ? 'selected' : ''}`;
                div.innerText = `${String.fromCharCode(65+i)}) ${opt}`;
                div.onclick = () => { answers[currentIdx] = i; renderQ(); };
                grid.appendChild(div);
            });

            document.getElementById('next-btn').style.display = currentIdx === questions.length - 1 ? 'none' : 'inline-block';
            document.getElementById('finish-btn').style.display = currentIdx === questions.length - 1 ? 'inline-block' : 'none';
        }

        function nextQ() { currentIdx++; renderQ(); }
        function prevQ() { if(currentIdx > 0) { currentIdx--; renderQ(); } }

        function finishQuiz() {
            clearInterval(timerInt);
            document.getElementById('quiz-core').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';
            
            let score = 0;
            let reviewHtml = "";
            questions.forEach((q, i) => {
                if(answers[i] === q.correct) score++;
                else {
                    reviewHtml += `<div class="review-box">
                        <strong>${i+1}. ${q.q}</strong><br>
                        <span style="color:red">Sua: ${answers[i] !== null ? q.options[answers[i]] : 'Em branco'}</span><br>
                        <span style="color:green">Correta: ${q.options[q.correct]}</span>
                        <p style="font-size:0.9rem; margin-top:5px; border-top:1px solid #ddd; padding-top:5px;"><i>Explicação: ${q.exp}</i></p>
                    </div>`;
                }
            });

            const percent = (score / questions.length) * 100;
            document.getElementById('score-text').innerText = `Acertos: ${score} de ${questions.length} (${percent.toFixed(1)}%)`;
            document.getElementById('feedback-msg').innerHTML = percent >= 80 ? 
                `<h2 style="color:green">APROVADO!</h2>` : `<h2 style="color:red">REPROVADO (Mínimo 80%)</h2>`;
            
            document.getElementById('review-area').innerHTML = "<h4>Revisão de Erros:</h4>" + (reviewHtml || "Excelente! Não houve erros.");

            new Chart(document.getElementById('scoreChart'), {
                type: 'doughnut',
                data: {
                    labels: ['Acertos', 'Erros'],
                    datasets: [{ data: [score, questions.length - score], backgroundColor: ['#27ae60', '#d63031'] }]
                }
            });
        }
    </script>
</body>

</html>






